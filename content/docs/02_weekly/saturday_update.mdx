---
title: 土曜日のデータ更新
description: 毎週土曜日に実行する、データメンテナンス（2週間ローリング）の手順です。
---

import { Step, Steps } from 'fumadocs-ui/components/steps';
import { Callout } from 'fumadocs-ui/components/callout';
import { Accordion, Accordions } from 'fumadocs-ui/components/accordion';
import { Files, File, Folder } from 'fumadocs-ui/components/files';
import {
	FileText,
	RefreshCw,
	Save,
	AlertTriangle,
	CheckSquare,
	Printer,
	HelpCircle,
	MousePointerClick,
	FileSpreadsheet,
	FolderSync,
	ClipboardList,
	Wrench,
} from 'lucide-react';

# <FolderSync className='inline w-[1em] h-[1em] mr-1 -mt-1' /> 土曜日のデータ更新

毎週土曜日に実行する、データメンテナンス作業です。
本システムは「2 週間分」のデータを管理しており、更新処理によってデータを 1 週間分ずらし（ローリングし）、翌週の製造指示が出せるようにします。

<Callout title="使用するファイル" icon={<FileText />}>
	**CB商品データ.xlsm** 
    
    <Files>
    	<Folder name='デスクトップ' defaultOpen>
    		<Folder name='よく使う' defaultOpen>
    			<Folder name='Backup'>
					<File name='CB商品データYYYY-MM-DD更新後.xlsm' icon={<FileSpreadsheet />} />
					<File name='CB商品データYYYY-MM-DD更新前.xlsm' icon={<FileSpreadsheet />} />
					<File name='CB商品データYYYY-MM-DD〇〇店変更.xlsm' icon={<FileSpreadsheet />} />
					<File name='CB商品データYYYY-MM-DD更新後.xlsm' icon={<FileSpreadsheet />} />
					...
				</Folder>
    			<Folder name='商品データ' defaultOpen>
					<Folder name='商品ごとの表'></Folder>
					<File name='CB商品データ.xlsm' icon={<FileSpreadsheet />} />
				</Folder>
    			<Folder name='伝票作成'>
					<Folder name='納品記録'>
						<Folder name='納品記録PDF'>
							<Folder name='YYYY-MM'></Folder>
							<Folder name='YYYY-MM'></Folder>
						</Folder>
					</Folder>
    				<File name='T納品データ.xlsm' icon={<FileSpreadsheet />} />
    			</Folder>
    		</Folder>
    	</Folder>
    </Files>

</Callout>

## <ClipboardList className='inline w-[1em] h-[1em] mr-1 -mt-1' /> 操作手順

<Steps>
<Step>
 
### 事前確認（月曜分の印刷）

更新を行う前に、直近（月曜日）の製造数に変化がないか確認します。

1. **「明後日」** ボタン等を使い、**月曜日** までの「伝票用」シートを表示・印刷します。
2. **色の変化をチェックしてください。**
   - シートには「前日分と数量が違うと色が変わる」条件付き書式が設定されています。
   - 急な変更を見落とさないよう、必ず確認してください。

<Callout type="info" title="月曜日は色が変わって当たり前">
	日曜日の納品数は少ないため、月曜日の数量は前日比で大きく増え、**ほぼ確実に色が付きます。**\
	「色が着いている＝異常」ではないので、極端な変更がないかだけ確認してください。
</Callout>

</Step>
<Step>
 
### 更新前のバックアップ（必須）

万が一データが消えても復旧できるように、必ず[バックアップ](../04_ad_hoc/index.mdx)を取ります。

1. `CB商品データ.xlsm` を一度閉じます。
2. ファイルをコピーし、`BackUp` フォルダへ保存します。
   - **保存先:** `デスクトップ` > `よく使う` > `BackUp`
   - **ファイル名:** `CB商品データ2025-12-13更新前.xlsm`
     - ※必ず **今日の日付** を入れてください

<Callout type="tip" title="なぜバックアップするの？">
	もしこの後の「更新」ボタン操作でミスがあったり、データが破損してしまった場合、このバックアップファイルを使って作業をやり直すことができます。
</Callout>

</Step>
<Step>
 
### 更新実行

1. ファイルを開き、**「操作」シート** を表示します。
2. **「更新」** ボタンをクリックします。
3. 「更新作業を行います。よろしいですか？」と聞かれるので、**「OK」** を押します。

<Callout type="info" title="処理の内容">
	* 各店舗シートの **J列〜P列 (翌週分)** のデータがコピーされ、**C列〜I列 (今週分)** に値貼り付け（上書き）されます。 
    * 操作シートの日付が1週間分更新されます。

</Callout>

</Step>
<Step>
 
### 検食 (菌検査) データの入力

検食用のパンを確保するため、数量を調整します。
**更新直後は右側（翌週分）のデータが残っている** ため、一度リセットしてから入力します。

1. **「検食」シート** を開きます。
2. **翌週分 (右側)** の数量をすべて `0` に書き換えます。
3. 以下の **固定検食** を毎日 `1` にします。
   - **プレミアム食パン 1/4**
   - **バターチキンカレーパン**
4. **「菌検査スケジュール表 (紙)」** を確認し、該当する日・商品の数量に `+1` していきます。

</Step>
<Step>
 
### 数量修正の反映

店舗や本社から依頼があった修正内容を反映させます。

- **修正依頼:** 月曜までに届いている依頼内容を入力します。
- **定休日対応:** お休みの店舗がある場合は `0` にします。
- **イレギュラー対応:** 「お楽しみ袋」や「新商品」などの特注対応を入力します。

<Callout type="warn" title="復旧忘れに注意" icon={<AlertTriangle />}>
	特売やイベントで一時的に数量を変えた場合は、イベント終了後に元の数量に戻すのを忘れないようにしてください。
</Callout>

</Step>
<Step>
 
### 全部まとめて出力・印刷

修正が終わったら、帳票類を一括出力して印刷します。
ここから大量に印刷を行うため、**事前にプリンターの用紙を補充しておいてください。**

1. **「操作」シート** に戻ります。
2. **「全部まとめて出力」** ボタンをクリックします。

<Callout type="warn" title="処理待ちの注意" icon={<MousePointerClick />}>
	**絶対に触らないでください**

    10種類以上のシート作成と計算を行うため、処理に時間がかかります。
    画面が白くなったりしても、**「完了」のメッセージが出るまでキーボードやマウスに触れずに待機してください。**

</Callout>

![全部まとめて出力ボタン](/images/Output_All_Button.png)

3. 以下の **10 種類** のシートが正しく印刷されたか確認してください。

<Callout title="印刷するシート一覧" icon={<CheckSquare />}>

    1. **製造数**
    2. **昼間用** (月曜日分)
    3. **冷凍生地出し**
    4. **スクラッチ生地出し**
    5. **並べる表**
    6. **ラベル出し**
    7. **クリエ製造数**
    8. **クリエラベル出し**
    9. **仕入先別発注表**
    10. **1日の使用量**

</Callout>

</Step>
<Step>
 
### 商品別数量表の印刷

最後に、店舗ごとの仕分けに使う表を印刷します。

1. **「商品別数量表」** ボタンをクリックします。\
   ※新しいブックが作成されます。
2. 作成されたブックの **「全シート」** を印刷します。

</Step>
<Step>
 
### 更新後のバックアップ（完了）

来週の作業開始地点として、確定したデータを保存します。

1. ファイルを上書き保存して閉じます。
2. 再度ファイルをコピーし、`BackUp` フォルダへ保存します。
   - **ファイル名:** `CB商品データ2025-12-13更新完了.xlsm`\
     ※こちらも **今日の日付** を入れて保存してください。

</Step>
</Steps>

---

## <Wrench className='inline w-[1em] h-[1em] mr-1 -mt-1' /> 管理者向け情報

<Accordions>
<Accordion title="更新マクロの仕様 (Sub 更新)" icon={<RefreshCw />}>
  **処理内容:**
  1. 定義されたシート (`先頭` 〜 `クリエ末尾` の間) をループ処理します。
  2. `J5:P最終行` (翌週エリア) をコピーし、`C5` (今週エリア) に **値貼り付け** します。
  3. A列5行目以降が空欄のシートはスキップされます。
</Accordion>
<Accordion title="マクロ名「フォーム後処理」について" icon={<HelpCircle />}>
  コード内に `Call フォーム後処理` という記述がありますが、これは**歴史的経緯による命名**です。
  
  * **経緯:** 以前は検食入力用のユーザーフォームが存在しましたが、「手入力の方が早い」という理由で廃止されました。
  * **現在:** 単に更新完了日時 (`Now`) を記録し、完了メッセージを出すだけの処理になっています。
</Accordion>
<Accordion title="「全部まとめて出力」の内訳" icon={<Printer />}>
  このボタンは、以下の処理を順番に呼び出すラッパーマクロです。

```vb
Sub 全部まとめて出力()
    Call 合計まとめて出力         ' CB/クリエ/全体製造数
    Call まとめてラベル出し出力     ' ローゼン/クリエ消費期限チェック
    Call 生地出し並べ表まとめて出力 ' 冷凍/スクラッチ/並べる表
    Call 発注表作成              ' 原材料発注計算
    Call 発注表_仕入先別出力      ' 発注書印刷
End Sub
```

</Accordion>
</Accordions>
