---
title: 納品記録の保存
description: 明日の納品データを確定させ、記録用PDFとして保存する手順です。
---

import { Step, Steps } from 'fumadocs-ui/components/steps';
import { Callout } from 'fumadocs-ui/components/callout';
import { Accordion, Accordions } from 'fumadocs-ui/components/accordion';
import {
	FileText,
	Save,
	AlertTriangle,
	FolderOpen,
	MousePointerClick,
	Search,
	CheckCircle,
} from 'lucide-react';

# 💾 納品記録の保存

翌日納品分の売上データを確定させ、記録用の PDF ファイルを保存します。
「日替わり表の印刷」が完了した後に、手が空いたタイミングで実施してください（当日中で OK）。

<Callout title="使用するファイル" icon={<FileText />}>
	**T納品データ.xlsm** 
    
    * **場所:** `デスクトップ` > `よく使う` > `伝票作成` フォルダ内

</Callout>

## 📋 操作手順

<Steps>
<Step>
 
### ファイルを開く

`T納品データ.xlsm` を開きます。
「ホーム」シートが表示されていることを確認してください。

</Step>
<Step>
 
### 集計の実行

メニューにある **「集計」** ボタンをクリックします。
最新のデータが読み込まれ、全店舗分の納品数が計算されます。

<Callout type="warn" icon={<MousePointerClick />}>
	**絶対に触らないでください** 
    
    
    処理には数秒〜数十秒かかります。
	画面が白くなったり、「応答なし」と表示されることがありますが、裏で計算中です。
	**「集計完了！」**
	というメッセージが出るまで、キーボードやマウスには触れずに待機してください。

</Callout>

</Step>
<Step>
 
### PDF 作成・保存

続いて **「納品記録 PDF」** ボタンをクリックします。
処理中は進捗バーが表示されます。

![PDF保存ボタンの場所](https://placehold.co/600x400?text=PDF+Button)

</Step>
<Step>
 
### 保存結果の確認（重要！）

「書き込み&保存完了！」等のメッセージが表示されたら、正しく保存されたか確認します。

1. **保存先フォルダ** を開きます。
   - `デスクトップ` > `よく使う` > `伝票作成` > `納品記録` > `納品記録PDF`
2. **日付フォルダ** (`yyyy-mm` > `yyyy-mm-dd`) を開きます。
3. **以下のポイントをチェックしてください：**
   - [ ] 店舗ごとの PDF ファイルが揃っていますか？
   - [ ] **ランダムに 1 つ開いて、金額が `0円` になっていませんか？**
     - （※もし 0 円の場合は、マスタ登録漏れの可能性があります）

<Callout type="tip" title="便利ワザ">
	この「納品記録PDF」フォルダのショートカットをデスクトップに作っておくと、毎回の確認が楽になります！
</Callout>

</Step>
<Step>
 
### 保存して終了

確認ができたら、ファイルを上書き保存して終了します。

- **ショートカット:** キーボードの `Ctrl` を押しながら `S` を押すとすぐに保存できます。

</Step>
</Steps>

---

## ❓ トラブルシューティング

<Accordions>
	<Accordion
		title="金額が0円になっている / 商品名が表示されない"
		icon={<Search />}
	>
		**原因:**
		新商品などの「価格マスタ」または「商品マスタ」の登録が漏れている可能性があります。

    	**対処法:**
        1. [新商品登録フロー](/docs/04_ad_hoc/new_product/05_t_data) を参照し、`T価格履歴` シートに価格を登録してください。
        2. 登録後、もう一度この手順の最初から（集計ボタンから）やり直してください。
    </Accordion>
    <Accordion title="エラーで止まってしまった" icon={<AlertTriangle />}>
    	もし「デバッグ」というボタンが出るエラー画面になった場合は、**「終了」**
    	を押してファイルを閉じてください。
    	その後、システム担当（結城）へ状況を報告してください。
    </Accordion>

</Accordions>

---

## 🔧 管理者向け情報

<Accordions>
<Accordion title="保存先フォルダの自動生成" icon={<FolderOpen />}>
  PDF保存マクロ実行時、該当日付のフォルダが存在しない場合は自動的に作成 (`MkDir`) される仕様です。
  手動でフォルダを作る必要はありません。
</Accordion>
<Accordion title="単価参照のロジック" icon={<FileText />}>
    納品書に記載される商品単価は、単純なマスタ参照ではなく、**「価格履歴テーブル」** から取得しています。

    - **ロジック:** `GetPriceByCompany` 関数を使用。
    - **条件:** 商品 ID と会社名が一致し、かつ「適用開始日」が納品日以前であるデータの中で、最新の単価を参照します。
    - **注意点:** 新商品を登録する際は、`T価格履歴` シートへの登録を忘れると単価が `0円` になります。

</Accordion>
</Accordions>
