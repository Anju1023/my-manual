---
title: 'Step 5: 納品データ登録'
description: 納品書発行システム (T納品データ) に、新商品のマスタ情報を手動で登録します。
---

import { Step, Steps } from 'fumadocs-ui/components/steps';
import { Callout } from 'fumadocs-ui/components/callout';
import { Accordion, Accordions } from 'fumadocs-ui/components/accordion';
import { Files, File, Folder } from 'fumadocs-ui/components/files';
import {
	FileText,
	AlertTriangle,
	Database,
	CalendarClock,
	DollarSign,
	CheckCircle,
	Image,
	HelpCircle,
	FileSpreadsheet,
} from 'lucide-react';

# Step 5: 納品データの登録

売上管理および納品書発行システムである `T納品データ.xlsm` に新商品の情報を登録します。
**`CB商品データ` とは自動連携していない** ため、ここでも手動での登録作業が必要です。

<Callout title="使用するファイル" icon={<FileText />}>
	**T納品データ.xlsm**

    * **場所:** `デスクトップ` > `よく使う` > `伝票作成` フォルダ内
    <Files>
    	<Folder name='デスクトップ' defaultOpen>
    		<Folder name='よく使う' defaultOpen>
    			<Folder name='Backup'>
    				<File name='CB商品データYYYY-MM-DD更新後.xlsm' icon={<FileSpreadsheet />} />
    				<File name='CB商品データYYYY-MM-DD更新前.xlsm' icon={<FileSpreadsheet />} />
    				<File name='CB商品データYYYY-MM-DD〇〇店変更.xlsm' icon={<FileSpreadsheet />} />
    				<File name='CB商品データYYYY-MM-DD更新後.xlsm' icon={<FileSpreadsheet />} />
    				...
    			</Folder>
    			<Folder name='商品データ'>
    				<Folder name='商品ごとの表'></Folder>
    				<File name='CB商品データ.xlsm' icon={<FileSpreadsheet />} />
    			</Folder>
    			<Folder name='伝票作成' defaultOpen>
    				<Folder name='納品記録'>
    					<Folder name='納品記録PDF'>
    						<Folder name='YYYY-MM'></Folder>
    						<Folder name='YYYY-MM'></Folder>
    					</Folder>
    				</Folder>
    				<File name='T納品データ.xlsm' icon={<FileSpreadsheet />} />
    			</Folder>
    			<File name='シフト表.xlsx' icon={<FileSpreadsheet />} />
    		</Folder>
    	</Folder>
    </Files>

</Callout>

## 📋 登録手順

<Steps>
<Step>

### ファイルを開く

`T納品データ.xlsm` を開き、編集可能な状態にします。

</Step>
<Step>

### 商品マスタへの追加

Excel 画面下部のシート見出し（タブ）から **「T 商品マスター」** をクリックして開きます。

{/* ↓↓↓ シート見出しの場所を示すスクショ ↓↓↓ */}
![シート見出しの場所](/images/Select_Sheet_Tab.png)

表の一番下の空行に、以下の情報を入力します。

| 項目        | 入力内容                                                 |
| :---------- | :------------------------------------------------------- |
| **商品 ID** | [Step 4](./04_cb_data) で自動発行された ID (例: `S0123`) |
| **商品名**  | 商品の正式名称                                           |

<Callout type="warn" title="IDは一言一句同じに！" icon={<AlertTriangle />}>
	[Step 4](./04_cb_data) の `CB商品データ` で発行されたIDと **完全に一致**
	させてください。 1文字でも違うと連携されません。
</Callout>

</Step>
<Step>

### 価格履歴への追加

続いて、シート見出しから **「T 価格履歴」** を選択します。
同様に表の一番下の空行に、価格情報を登録します。

**納品先ごとに登録が必要です。**

| 項目           | 入力内容                  | 注意点                              |
| :------------- | :------------------------ | :---------------------------------- |
| **商品 ID**    | 商品 ID                   | 上記と同じ ID                       |
| **社名**       | `ローゼン` / `クリエイト` | **どちらかを必ず入れること**        |
| **適用開始日** | 商品の発売日              | **この日付より前は 0 円になります** |
| **単価**       | 納品単価 (税抜)           | **半角数字** で入力                 |

<Callout type="info" title="クリエイトでも販売する場合" icon={<DollarSign />}>
	ローゼンとクリエイト両方で販売する場合は、**2行分の登録** が必要です。
	（社名を `クリエイト` に変えて、もう1行追加してください）
</Callout>

</Step>
<Step>

### 完了・保存

入力内容（特に単価と開始日）に間違いがないか確認したら、ファイルを **上書き保存** して閉じます。

</Step>
</Steps>

---

## ⚠️ よくあるトラブル

登録したはずなのに、納品書がおかしい…と思ったらここをチェック！

<Accordions>
    <Accordion title="納品書の金額が 0円 になる" icon={<HelpCircle />}>
        **原因:** 該当する日付の単価が見つかっていません。
        
        * 👉 **「適用開始日」** が未来の日付になっていませんか？
        * 👉 **「社名」** は正確ですか？
    </Accordion>
    <Accordion title="商品名が表示されない" icon={<HelpCircle />}>
        **原因:** 商品マスタとの紐づけがうまくいっていません。

        * 👉 **「T 商品マスター」** への登録を忘れていませんか？
        * 👉 **「商品ID」** はCBデータと完全に一致していますか？（スペースなどが含まれていないか確認）
    </Accordion>

</Accordions>

---

## 🔧 管理者向け情報

<Callout type="info" title="単価参照ロジック (System Specs)" icon={<Database />}>
    本システムでは、納品日時点での単価を正確に参照するため、「履歴テーブル (`T価格履歴`)」を持っています。

    - **使用関数:** `GetPriceByCompany`
    - **取得ロジック:**
      1. `商品ID` と `社名` が一致するデータを抽出
      2. その中で `適用開始日 <= 納品日` の条件を満たすものを絞り込み
      3. 最も `適用開始日` が新しいデータの単価を採用

</Callout>
