---
title: 'Step 6: 数量入力と印刷'
description: 新商品の製造予定数を入力し、帳票を出力して確認する手順です。
---

import { Step, Steps } from 'fumadocs-ui/components/steps';
import { Callout } from 'fumadocs-ui/components/callout';
import { Accordion, Accordions } from 'fumadocs-ui/components/accordion';
import {
	FileText,
	AlertTriangle,
	Calculator,
	Scissors,
	Copy,
	CheckCircle,
	Keyboard,
	MousePointerClick,
} from 'lucide-react';

# Step 6: 数量入力と印刷

[Step 4](./04_cb_data) での登録完了後、各店舗の製造予定数を入力します。
社長への依頼用 Excel ファイルを作成・送付し、入力されたデータを `XLOOKUP` 関数を使用して一括で取り込みます。

<Callout title="使用するファイル" icon={<FileText />}>
	**CB商品データ.xlsm**

    * **場所:** `デスクトップ` > `よく使う` > `商品データ` フォルダ内
    * **フルパス:** `C:\Users\nanbu\OneDrive\Desktop\よく使う\商品データ\`

</Callout>

## 📋 手順 1: 依頼ファイルの作成

社長に入力してもらうための専用ファイルを加工します。
**数式を破損しないよう、以下の手順通りに操作してください。**

<Steps>
<Step>

### シートのコピー

1. `CB商品データ.xlsm` を開きます。
2. **「伝票用」** シートを右クリックし、「移動またはコピー」から **「新しいブック」** へコピーを作成します。

</Step>
<Step>

### 日付の変更 (最優先事項)

**この段階では「値貼り付け」を行わないでください。**
先に日付を変更し、関数（ベビアン判定や価格参照）を正しく作動させる必要があります。

1. **A1 セル** の日付を **直近の「水曜日」または「土曜日」** に変更します。
2. データの表示（商品名や価格）が正しく反映されたことを確認します。

</Step>
<Step>

### 商品・店舗情報の「値」化

B 列のスピル配列エラーを回避するため、編集箇所の周辺を「値」に変換します。

1. **A 列〜C 列 (商品名・売価・原価)** を選択 → コピー → **値貼り付け**。
2. **1 行目〜3 行目 (店舗名・番号)** を選択 → コピー → **値貼り付け**。
3. **E5 セルから右下のデータ範囲** (店舗の数量入力欄) を選択 → コピー → **値貼り付け**。

<Callout type="info" title="操作のヒント" icon={<Keyboard />}>
	**値貼り付けのショートカット:** `アプリケーションキー` (または右クリック) →
	`V`
</Callout>

<Callout type="error" title="【重要】数式のまま残すべき箇所" icon={<AlertTriangle />}>
    以下のセル・列には集計用の数式が含まれています。**絶対に「値」に変換しないでください。**

    * **D列** (個数合計 `SUM`)
    * **E4行** (店舗合計)
    * **51行目** (金額合計)

</Callout>

</Step>
<Step>

### 新商品枠の作成 (行の入れ替え)

通常商品の一番下に新商品の入力枠を作成します。

1. **通常商品の「最下行（一番下の商品）」** の行番号を選択し、**「挿入」** します。
   - ※その上に空行が作成されます。
2. 空行に **新商品の「商品名」** と **「売価」** を入力します。
3. **D 列の数式** を上の行からコピーします。
4. **「元々一番下だった商品」** を新商品の上に移動させます（順番の入れ替え）。

<Accordions>
    <Accordion title="行の入れ替え手順" icon={<MousePointerClick />}>
        **方法A: Shiftドラッグ**
        1. 行を選択し、枠線を **Shiftキーを押しながら** ドラッグ＆ドロップします。

        **方法B: 切り取り＆挿入**
        1. 移動したい行を選択して **「切り取り (Ctrl+X)」**
        2. 移動先の行で右クリック → **「切り取ったセルの挿入」**
    </Accordion>

</Accordions>

</Step>
<Step>

### 保存と送付

ファイル名を `新商品数量入力依頼.xlsx` として保存し、社長へ送付します。

</Step>
</Steps>

## 📋 手順 2: データの取り込み

社長からファイルが返信され次第、`CB商品データ` に取り込みます。
データの行位置は毎回異なる可能性があるため、テンプレートは使用せず **マウスで範囲を指定** してください。

<Steps>
<Step>

### 準備

1. 返信された **「社長ファイル」** と `CB商品データ.xlsm` を両方開きます。
2. 作業しやすいよう、画面を並べて表示します。

</Step>
<Step>

### XLOOKUP 関数の入力

`CB商品データ` の新商品の行（最初の店舗のセル）に、以下の手順で数式を作成します。

1. セルに `=XLOOKUP($R$1,` と入力します。
   - ※ `$R$1` は店舗名が入力されているセルです。
2. マウスで **【社長ファイル】の「店舗名がある行 (1 行目)」** を行ごと選択します。
3. `,` (カンマ) を入力します。
4. マウスで **【社長ファイル】の「新商品の数量が入っている行」** を行ごと選択します。
5. `, 0)` と入力して Enter キーを押します。

<Callout type="info" title="数式の完成イメージ" icon={<CheckCircle />}>
    正しく入力された場合、以下のような数式になります。

    <div className="my-2"></div>

    ```vb
    =XLOOKUP($R$1, [新商品数量入力依頼.xlsx]Sheet1!$1:$1, [新商品数量入力依頼.xlsx]Sheet1!$15:$15, 0)
    ```

</Callout>

</Step>
<Step>

### 値貼り付け (必須作業)

数式を入力して全店舗にコピー（オートフィル）した後、**必ず「値」に変換してください。**
この作業を忘れると、参照元のファイルを閉じた後にエラーとなります。

1. 数式が入ったセル範囲を選択して **コピー** します。
2. そのまま **「値貼り付け (123)」** を行います。

</Step>
</Steps>

---

## ✅ 次のステップ

数量の入力完了後、以下の作業を行ってください。

1. **「全店舗分出力」** ボタンを押し、印刷して各店の数量を確認する。
2. 問題がなければ、最後のステップ **[Step 7: 伝票調整](./07_layout)** へ進む。
